# Module 1 Lesson 8: 智能副官：AI Sidebar Agent 协作协议

> **课程体系：Learn Python with AI IDE**
> **当前模块**：Module 1 - The AI Ready Engineer
> **前修回顾**：在 [M1L7] 中，我们构建了稳固的工程结构。
> **本课目标**：确立与 AI Agent 的协作边界。掌握 **“Plan -> Apply -> Verify”** 的标准作业程序 (SOP)。

---

## 1. 聊天窗口 vs Agent：区别在哪里？

你可能用过 ChatGPT 网页版。你把代码复制进去，它给你改好，你再复制回来。
这叫 **Chatbot (聊天机器人)**。

IDE 侧边栏里的叫 **Agent (智能体)**。
区别在于**“手”**。
*   Chatbot 只有“嘴”，它只能给你建议。
*   Agent 有“手”，它可以：
    *   直接读取你的整个项目文件（不需要你复制）。
    *   直接读取终端的报错信息。
    *   **直接修改你的代码文件**（这是最危险也最强大的能力）。

---

## 2. 核心风险：盲目应用 (Blind Apply)

这是新手最容易犯的工程灾难：
1.  Agent 生成了一大段代码。
2.  新手看都没看，直接点击 `Apply`。
3.  程序跑崩了，而且原本能跑的功能也被覆盖了。
4.  新手不知道改了哪，甚至无法撤销。

**铁律**：Agent 只是提议者 (Proposer)。你是审核者 (Auditor)。永远不要让实习生未经审核直接合并代码。

---

## 3. 标准作业程序 (SOP)：PAV 循环

为了安全地利用 Agent 的能力，我们严格遵守 **PAV 协议**：

### 3.1 P - Plan (让它先说计划)
不要上来就让它改代码。先问思路。
*   **Prompt**: *"我现在的 requirements.txt 有依赖冲突，请分析原因并**列出你打算修改哪些文件**？"*
*   **目的**：确认它的修改范围是否合理（比如：它想改 `main.py`，但你只是问个数据问题，这就越界了）。

### 3.2 A - Apply with Review (差异对比应用)
当 Agent 给出代码块时，不要点 `Copy`，要点 `Apply`（或类似按钮，不同 IDE 叫法不同，通常会像 Git Diff 一样展示变更）。
*   **动作**：IDE 会分屏显示 【你的原代码】 vs 【AI 建议代码】。
*   **审查**：只看**绿色**（新增）和**红色**（删除）的部分。
*   **决策**：只有当你确认“这一行修改是合理的”，才点击 `Accept`。

### 3.3 V - Verify (最小验证)
Apply 之后，不要急着继续对话。
*   **动作**：立刻在终端运行一次代码（或运行测试）。
*   **意义**：确保这次修改没有引入新的 Bug（回归测试）。如果报错，立刻回滚 (Ctrl+Z)。

---

## 4. 实战演示：修复 Bug

让我们模拟一次协作。

1.  **制造故障**：在 `ide_demo.py` 中故意写错一行代码（比如引用一个不存在的库）。
2.  **召唤 Agent**：选中报错行，按 `Cmd/Ctrl + L` (或 IDE 对应快捷键) 发送给 Agent。
3.  **Prompt**: *"这段代码报错了，请解释原因并修复。"*
4.  **执行 PAV**：
    *   **P**: 看它的解释（“未安装库”或“拼写错误”）。
    *   **A**: 点击 Apply，查看 Diff。确认它是不是只改了那一行，且没有偷偷删掉你的注释。
    *   **V**: 运行修复后的脚本，确认报错消失。

---

## 5. 禁区：不要让 Agent 做什么

1.  **不要让它“重写整个文件”**：除非文件很小。否则很难审查 Diff。要求它 *"只修改变动的部分"*。
2.  **不要让它处理涉密信息**：不要把 `.env` 里的私钥发给它（虽然企业版 IDE 声称隐私合规，但作为工程师应保持零信任）。
3.  **不要让它代替你思考架构**：你可以问 *"有哪些设计模式推荐"*，但不要说 *"帮我把整个项目架构设计出来"*。

---

## 6. 工程自检 (Engineering Checkpoint)

### ✅ 验收标准 (Pass Criteria)
1.  **Diff 熟练度**：你能够熟练使用 IDE 的 Diff 视图（左右对比模式），并能指出 AI 到底改了哪几行。
2.  **回滚能力**：在 Apply 了错误代码后，能迅速使用 `Ctrl+Z` 或 Git 撤销修改。
3.  **上下文控制**：知道如何把引用文件 (At-mention, `@file`) 加入给 Agent 的提示词中，让它只关注特定文件。

### 🛑 常见故障 (Fail & Triage)
*   **故障 1**：Agent 胡乱修改了我不相关的文件。
    *   *原因*：Context（上下文）给多了，或者没指定 scope。
    *   *对策*：Prompt 里明确 *"只修改 main.py，不要动 utils.py"*。
*   **故障 2**：Apply 按钮是灰色的 / 找不到。
    *   *原因*：IDE 插件未更新，或者当前文件是只读的。
    *   *对策*：更新 IDE，或手动复制粘贴。

---

> [!IMPORTANT]
> **本课结语**
>
> Agent 是很好的副驾驶，但如果你睡着了，它可能会把车开到沟里。
> **PAV 协议 (Plan-Apply-Verify)** 是你在 AI 时代的驾驶执照。
>
> **下一课，我们将总结 Module 1，确立人机协作的终极心法。**
